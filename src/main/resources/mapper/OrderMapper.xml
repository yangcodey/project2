<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.project2.mapper.OrderMapper">

    <resultMap id="BaseResultMap" type="com.example.project2.entity.Order">
        <id column="id" property="id" jdbcType="BIGINT"/>
        <result column="order_no" property="orderNo" jdbcType="VARCHAR"/>
        <result column="product_id" property="productId" jdbcType="BIGINT"/>
        <result column="buyer_id" property="buyerId" jdbcType="BIGINT"/>
        <result column="quantity" property="quantity" jdbcType="INTEGER"/>
        <result column="unit_price" property="unitPrice" jdbcType="DECIMAL"/>
        <result column="total_amount" property="totalAmount" jdbcType="DECIMAL"/>
        <result column="order_time" property="orderTime" jdbcType="TIMESTAMP"/>
        <result column="payment_method" property="paymentMethod" jdbcType="VARCHAR"/>
        <result column="payment_time" property="paymentTime" jdbcType="TIMESTAMP"/>
        <result column="delivery_address" property="deliveryAddress" jdbcType="VARCHAR"/>
        <result column="contact_phone" property="contactPhone" jdbcType="VARCHAR"/>
        <result column="status" property="status" jdbcType="VARCHAR"/>
        <result column="remark" property="remark" jdbcType="VARCHAR"/>
        <result column="created_at" property="createdAt" jdbcType="TIMESTAMP"/>
        <result column="updated_at" property="updatedAt" jdbcType="TIMESTAMP"/>
    </resultMap>

    <sql id="Base_Column_List">
        id, order_no, product_id, buyer_id, quantity, unit_price, total_amount, order_time, 
        payment_method, payment_time, delivery_address, contact_phone, status, remark, created_at, updated_at
    </sql>

    <select id="selectById" parameterType="java.lang.Long" resultMap="BaseResultMap">
        SELECT
        <include refid="Base_Column_List"/>
        FROM orders
        WHERE id = #{id}
    </select>

    <select id="selectByOrderNo" parameterType="java.lang.String" resultMap="BaseResultMap">
        SELECT
        <include refid="Base_Column_List"/>
        FROM orders
        WHERE order_no = #{orderNo}
    </select>

    <select id="selectAll" resultMap="BaseResultMap">
        SELECT
        <include refid="Base_Column_List"/>
        FROM orders
        ORDER BY created_at DESC
    </select>

    <select id="selectByBuyerId" parameterType="java.lang.Long" resultMap="BaseResultMap">
        SELECT
        <include refid="Base_Column_List"/>
        FROM orders
        WHERE buyer_id = #{buyerId}
        ORDER BY created_at DESC
    </select>

    <select id="selectByProductId" parameterType="java.lang.Long" resultMap="BaseResultMap">
        SELECT
        <include refid="Base_Column_List"/>
        FROM orders
        WHERE product_id = #{productId}
        ORDER BY created_at DESC
    </select>

    <select id="selectByStatus" parameterType="java.lang.String" resultMap="BaseResultMap">
        SELECT
        <include refid="Base_Column_List"/>
        FROM orders
        WHERE status = #{status}
        ORDER BY created_at DESC
    </select>

    <insert id="insert" parameterType="com.example.project2.entity.Order" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO orders (order_no, product_id, buyer_id, quantity, unit_price, total_amount, order_time, 
                           payment_method, payment_time, delivery_address, contact_phone, status, remark, created_at, updated_at)
        VALUES (#{orderNo}, #{productId}, #{buyerId}, #{quantity}, #{unitPrice}, #{totalAmount}, #{orderTime}, 
                #{paymentMethod}, #{paymentTime}, #{deliveryAddress}, #{contactPhone}, #{status}, #{remark}, NOW(), NOW())
    </insert>

    <update id="update" parameterType="com.example.project2.entity.Order">
        UPDATE orders
        <set>
            <if test="orderNo != null">order_no = #{orderNo},</if>
            <if test="productId != null">product_id = #{productId},</if>
            <if test="buyerId != null">buyer_id = #{buyerId},</if>
            <if test="quantity != null">quantity = #{quantity},</if>
            <if test="unitPrice != null">unit_price = #{unitPrice},</if>
            <if test="totalAmount != null">total_amount = #{totalAmount},</if>
            <if test="orderTime != null">order_time = #{orderTime},</if>
            <if test="paymentMethod != null">payment_method = #{paymentMethod},</if>
            <if test="paymentTime != null">payment_time = #{paymentTime},</if>
            <if test="deliveryAddress != null">delivery_address = #{deliveryAddress},</if>
            <if test="contactPhone != null">contact_phone = #{contactPhone},</if>
            <if test="status != null">status = #{status},</if>
            <if test="remark != null">remark = #{remark},</if>
            updated_at = NOW()
        </set>
        WHERE id = #{id}
    </update>

    <update id="updateStatus">
        UPDATE orders
        SET status = #{status}, updated_at = NOW()
        WHERE id = #{id}
    </update>

    <update id="updatePayment">
        UPDATE orders
        SET payment_method = #{paymentMethod}, payment_time = #{paymentTime}, updated_at = NOW()
        WHERE id = #{id}
    </update>

    <delete id="deleteById" parameterType="java.lang.Long">
        DELETE FROM orders WHERE id = #{id}
    </delete>

</mapper>
